<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>Box Tab</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <script src="https://cdn.polyfill.io/v2/polyfill.min.js?features=es6,Intl"></script>
        <script
            src="https://statics.teams.cdn.office.net/sdk/v1.9.0/js/MicrosoftTeams.min.js"
            integrity="sha384-bcRxWKfzRyPxg/waVm3IsOnaH2Inoh5gGIJNOat79+wq22/BZ+mFuSTUmVc7l2el"
            crossorigin="anonymous"
        ></script>
        <link
            rel="stylesheet"
            href="https://cdn01.boxcdn.net/platform/elements/11.0.2/en-US/explorer.css"
        />
        <!-- inject:css -->
        <link rel="stylesheet" href="/styles/main.css">
        <!-- endinject -->
    </head>

    <body>
        <div id="app">Loading...</div>
        <!-- <div class="container"></div> -->
        <!-- inject:js -->
        <script src="/scripts/client.js"></script>
        <!-- endinject -->
        <script type="text/javascript">
            integration.render(
                integration.BoxTab,
                document.getElementById("app"),
                {}
            );
        </script>
        <script src="https://cdn01.boxcdn.net/platform/elements/11.0.2/en-US/explorer.js"></script>
        <script>
            const authUrl = integration
                .getAuthUrl()
                .then((authorizationUrl) => {
                    integration.getTeamsRef().authentication.authenticate({
                        url: authorizationUrl,
                        width: 600,
                        height: 900,
                        successCallback: function (result) {
                            integration
                                .getToken(result)
                                .then(function (access_token) {
                                    let folderId = "0";
                                    const contentExplorer = new Box.ContentExplorer();
                                    contentExplorer.show(
                                        folderId,
                                        `${access_token}`,
                                        {
                                            container: ".container"
                                        }
                                    );
                                });
                        },
                        failureCallback: () => {
                            console.log("Error authenticating client.");
                        }
                    });
                });
            window.onload = () => {
                const code = new URLSearchParams(window.location.search).get(
                    "code"
                );
                if (code) {
                    integration
                        .getTeamsRef()
                        .authentication.notifySuccess(code);
                }
            };
        </script>
    </body>
</html>
