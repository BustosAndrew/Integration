<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>Box Tab</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <script src="https://cdn.polyfill.io/v2/polyfill.min.js?features=es6,Intl"></script>
        <link
            rel="stylesheet"
            href="https://cdn01.boxcdn.net/platform/elements/11.0.2/en-US/explorer.css"
        />
        <!-- inject:css -->
        <!-- endinject -->
    </head>

    <body>
        <div id="app">Loading...</div>
        <!-- <div class="container"></div> -->
        <!-- inject:js -->
        <!-- endinject -->
        <script type="text/javascript">
            integration.render(
                integration.BoxTab,
                document.getElementById("app"),
                {}
            );
        </script>
        <script src="https://cdn01.boxcdn.net/platform/elements/11.0.2/en-US/explorer.js"></script>
        <script>
            // let authWindow;
            const authUrl = integration
                .getAuthUrl()
                .then((authorizationUrl) => {
                    // authWindow = window.open(authorizationUrl);
                    microsoftTeams.authentication.authenticate({
                        url: authorizationUrl,
                        width: 600,
                        height: 535,
                        successCallback: function (result) {
                            integration
                                .getToken(result)
                                .then(function (access_token) {
                                    let folderId = "0";
                                    const contentExplorer = new Box.ContentExplorer();
                                    contentExplorer.show(
                                        folderId,
                                        `${access_token}`,
                                        {
                                            container: ".container"
                                        }
                                    );
                                });
                        },
                        failureCallback: () => {
                            console.log("Error authenticating client.");
                        }
                    });
                });
            // window.addEventListener(
            //     "message",
            //     (event) => {
            //         if (
            //             event.origin !==
            //             "https://box-integration-tab.herokuapp.com"
            //         )
            //             return;
            //         integration
            //             .getToken(event.data)
            //             .then(function (access_token) {
            //                 let folderId = "0";
            //                 const contentExplorer = new Box.ContentExplorer();
            //                 contentExplorer.show(folderId, `${access_token}`, {
            //                     container: ".container"
            //                 });
            //             });
            //     },
            //     false
            // );
        </script>
    </body>
</html>
